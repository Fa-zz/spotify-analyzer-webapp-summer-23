{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}User Profile{% endblock %}

{% block page_content %}

<h1>Hello, {{ user }} ðŸ˜Ž </h1>
    <h3>
        {% if followers == 0 %}
        You have no followers yet
        {% elif followers == 1 %}
        You have 1 follower
        {% else %}
        Congrats on the {{ followers }} followers!
        {% endif %}
    </h3>

<br>
<h3 id="result">{{ string }}</h3>
<br>

<div class="container">
    <form method="POST" id="user-form">
        <div class="row">
            <div class="col-md-4">
                {{ form.dd_type.label }}
                {{ form.dd_type(class="form-control", id="dd-type") }}
            </div>
            <div class="col-md-4">
                {{ form.dd_time_frame.label }}
                {{ form.dd_time_frame(class="form-control", id="dd-time-frame") }}
            </div>
            <div class="col-md-4">
                {{ form.dd_sort.label }}
                {{ form.dd_sort(class="form-control", id="dd-sort") }}
            </div>
        </div>
    </form>
</div>

<br>
<div class="container">
    <div class="row">
        {% if display %}
            <div class="row">
                {% for i in range(itemList|length) %}
                    <div class="col-md-4">
                        <div class="artist-item">
                            <img src="{{ imgList[i] }}" width="64" height="64">
                            <h5>{{ loop.index }}.<a href="{{ urlList[i] }}" target="_blank" title="Opens Spotify in a new tab"> {{ itemList[i] }}</a></h5>
                        </div>
                    </div>
                    {% if loop.index % 3 == 0 %}
                        </div><div class="row">
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    $(document).ready(function() {
        $('#dd-type, #dd-time-frame, #dd-sort').change(function() {
            const ddType = $('#dd-type').val();
            const ddTimeFrame = $('#dd-time-frame').val();
            const ddSort = $('#dd-sort').val();

            $.ajax({
                url: '{{ url_for('userdata.profile') }}',  // Update this URL to your route
                method: 'POST',
                data: {
                    dd_type: ddType,
                    dd_time_frame: ddTimeFrame,
                    dd_sort: ddSort
                },
            success: function(data) {
                $('#result').html(data.string);
                $('#selected-dd-type').html(data.selected_dd_type);  // Display selected values
                $('#selected-dd-time-frame').html(data.selected_dd_time_frame);
                $('#selected-dd-sort').html(data.selected_dd_sort);

                var display = data.display;
                var itemList = data.itemList;
                var imgList = data.imgList;
                var urlList = data.urlList;
                console.log(display);
                console.log(itemList, imgList, urlList);
            },
            error: function(error) {
                    console.error('Error:', error);
                }
            });
        });
    });
</script>
{% endblock %}